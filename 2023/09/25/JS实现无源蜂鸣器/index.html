<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>【笔记】JS实现无源蜂鸣器 | 绯鞠的博客</title><meta name="author" content="绯鞠"><meta name="copyright" content="绯鞠"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言JS实现无源蜂鸣器，从而实现伪钢琴音乐">
<meta property="og:type" content="article">
<meta property="og:title" content="【笔记】JS实现无源蜂鸣器">
<meta property="og:url" content="https://loli.fj.cn/2023/09/25/JS%E5%AE%9E%E7%8E%B0%E6%97%A0%E6%BA%90%E8%9C%82%E9%B8%A3%E5%99%A8/index.html">
<meta property="og:site_name" content="绯鞠的博客">
<meta property="og:description" content="前言JS实现无源蜂鸣器，从而实现伪钢琴音乐">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://loli.fj.cn/dist/images/avatar.jpg">
<meta property="article:published_time" content="2023-09-25T08:44:33.000Z">
<meta property="article:modified_time" content="2024-08-06T02:31:29.822Z">
<meta property="article:author" content="绯鞠">
<meta property="article:tag" content="Javascript">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://loli.fj.cn/dist/images/avatar.jpg"><link rel="shortcut icon" href="/dist/images/favicon_package/favicon-32x32.png"><link rel="canonical" href="https://loli.fj.cn/2023/09/25/JS%E5%AE%9E%E7%8E%B0%E6%97%A0%E6%BA%90%E8%9C%82%E9%B8%A3%E5%99%A8/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【笔记】JS实现无源蜂鸣器',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2024-08-06 10:31:29'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="绯鞠的博客" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/dist/images/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2918</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">115</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/reward/"><i class="fa-fw fa fa-hand-holding-heart"></i><span> 赞助</span></a></li><li><a class="site-page child" href="/atom.xml"><i class="fa-fw fa fa-rss"></i><span> 订阅</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="//keep.loli.fj.cn"><i class="fa-fw fa fa-arrow-right"></i><span> 主题</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="绯鞠的博客"><img class="site-icon" src="/dist/images/avatar.gif"/><span class="site-name">绯鞠的博客</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/reward/"><i class="fa-fw fa fa-hand-holding-heart"></i><span> 赞助</span></a></li><li><a class="site-page child" href="/atom.xml"><i class="fa-fw fa fa-rss"></i><span> 订阅</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="//keep.loli.fj.cn"><i class="fa-fw fa fa-arrow-right"></i><span> 主题</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">【笔记】JS实现无源蜂鸣器</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-09-25T08:44:33.000Z" title="发表于 2023-09-25 16:44:33">2023-09-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-06T02:31:29.822Z" title="更新于 2024-08-06 10:31:29">2024-08-06</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="【笔记】JS实现无源蜂鸣器"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>JS实现无源蜂鸣器，从而实现伪钢琴音乐</p>
<span id="more"></span>

<h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2><ul>
<li>为指定class的标签设置触摸事件，每当该标签被触摸时，都会发出一次蜂鸣器声音</li>
</ul>
<p>由于浏览器安全限制，需要用户在站点进行任意操作后才会触发声音，否则直接触摸该标签不会发出声音<br>例如：先点击一下该标签，之后每次触摸都会发出声音</p>
<ul>
<li>有两种方式实现打歌</li>
</ul>
<p>第一种方式是原代码作者方案：该代码原作者将所有蜂鸣器振动频率放到了一个以空格分开的字符串中，然后将字符串切割为数组<br>该方案的案例是歌曲《天空之城》</p>
<blockquote>
<p><code>t</code>：存放无源蜂鸣器振动频率的数组</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为指定class的标签设置触摸事件</span></span><br><span class="line">element_classname = [<span class="string">&quot;site-title&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">AudioContext</span> = <span class="variable language_">window</span>.<span class="property">AudioContext</span> || <span class="variable language_">window</span>.<span class="property">webkitAudioContext</span>,</span><br><span class="line"><span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">AudioContext</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> e = <span class="keyword">new</span> <span class="title class_">AudioContext</span>;</span><br><span class="line">        <span class="keyword">let</span> t = <span class="string">&quot;880 987 1046 987 1046 1318 987 659 659 880 784 880 1046 784 659 659 698 659 698 1046 659 1046 1046 1046 987 698 987 987 880 987 1046 987 1046 1318 987 659 659 880 784 880 1046 784 659 698 1046 987 1046 1174 1174 1174 1046 1046 880 987 784 880 1046 1174 1318 1174 1318 1567 1046 987 1046 1318 1318 1174 784 784 880 1046 987 1174 1046 784 784 1396 1318 1174 659 1318 1046 1318 1760 1567 1567 1318 1174 1046 1046 1174 1046 1174 1567 1318 1318 1760 1567 1318 1174 1046 1046 1174 1046 1174 987 880 880 987 880&quot;</span>.<span class="title function_">split</span>(<span class="string">&quot; &quot;</span>); <span class="comment">//天空之城</span></span><br><span class="line">        <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> o = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> element_classname) &#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(item)[<span class="number">0</span>].<span class="title function_">addEventListener</span>(<span class="string">&quot;mouseenter&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> r = t[i];</span><br><span class="line">                r || (i = <span class="number">0</span>, r = t[i]), i += o;</span><br><span class="line">                <span class="keyword">let</span> c = e.<span class="title function_">createOscillator</span>();</span><br><span class="line">                <span class="keyword">let</span> l = e.<span class="title function_">createGain</span>();</span><br><span class="line">                c.<span class="title function_">connect</span>(l);</span><br><span class="line">                l.<span class="title function_">connect</span>(e.<span class="property">destination</span>);</span><br><span class="line">                c.<span class="property">type</span> = <span class="string">&quot;sine&quot;</span>;</span><br><span class="line">                c.<span class="property">frequency</span>.<span class="property">value</span> = r;</span><br><span class="line">                l.<span class="property">gain</span>.<span class="title function_">setValueAtTime</span>(<span class="number">0</span>, e.<span class="property">currentTime</span>);</span><br><span class="line">                l.<span class="property">gain</span>.<span class="title function_">linearRampToValueAtTime</span>(<span class="number">1</span>, e.<span class="property">currentTime</span> + <span class="number">.01</span>);</span><br><span class="line">                c.<span class="title function_">start</span>(e.<span class="property">currentTime</span>);</span><br><span class="line">                l.<span class="property">gain</span>.<span class="title function_">exponentialRampToValueAtTime</span>(<span class="number">.001</span>, e.<span class="property">currentTime</span> + <span class="number">1</span>);</span><br><span class="line">                c.<span class="title function_">stop</span>(e.<span class="property">currentTime</span> + <span class="number">1</span>);</span><br><span class="line">                n = !<span class="number">1</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>

<p>第二种方式是我的方案：由于之前学习单片机时，学习过压缩的方式加载振动频率值，所以可以采用压缩的方式，先存储一个基本音数组，然后再存储曲谱数组，遍历曲谱数组中的音调转换为基本音的振动频率值数组<br>该方案的案例是歌曲《天空之城》优化版（优化了所有连续音符，将连续音符改为单音符，使其更适合JS蜂鸣器）</p>
<blockquote>
<p><code>t</code>：存放无源蜂鸣器振动频率的数组</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为指定class的标签设置触摸事件</span></span><br><span class="line">element_classname = [<span class="string">&quot;site-title&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// C大调钢琴音调</span></span><br><span class="line"><span class="keyword">const</span> pitch = [</span><br><span class="line">    <span class="number">262</span>, <span class="number">294</span>, <span class="number">330</span>, <span class="number">349</span>, <span class="number">392</span>, <span class="number">440</span>, <span class="number">494</span>,</span><br><span class="line">    <span class="number">523</span>, <span class="number">587</span>, <span class="number">659</span>, <span class="number">698</span>, <span class="number">784</span>, <span class="number">880</span>, <span class="number">988</span>,</span><br><span class="line">    <span class="number">1046</span>, <span class="number">1175</span>, <span class="number">1318</span>, <span class="number">1397</span>, <span class="number">1568</span>, <span class="number">1760</span>, <span class="number">1976</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据曲谱打歌</span></span><br><span class="line"><span class="keyword">const</span> tone = [</span><br><span class="line">    <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">13</span>,</span><br><span class="line">    <span class="number">9</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">11</span>,</span><br><span class="line">    <span class="number">9</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">9</span>,</span><br><span class="line">    <span class="number">14</span>, <span class="number">14</span>, <span class="number">13</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">13</span>,</span><br><span class="line">    <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">13</span>,</span><br><span class="line">    <span class="number">9</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">11</span>,</span><br><span class="line">    <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>,</span><br><span class="line">    <span class="number">14</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">12</span>,</span><br><span class="line">    <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">15</span>,</span><br><span class="line">    <span class="number">11</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">16</span>,</span><br><span class="line">    <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">11</span>,</span><br><span class="line">    <span class="number">17</span>, <span class="number">16</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">16</span>,</span><br><span class="line">    <span class="number">16</span>, <span class="number">19</span>, <span class="number">19</span>, <span class="number">18</span>, <span class="number">18</span>, <span class="number">16</span>, <span class="number">15</span>, <span class="number">14</span>,</span><br><span class="line">    <span class="number">14</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">18</span>, <span class="number">16</span>,</span><br><span class="line">    <span class="number">16</span>, <span class="number">19</span>, <span class="number">19</span>, <span class="number">18</span>, <span class="number">18</span>, <span class="number">16</span>, <span class="number">15</span>, <span class="number">14</span>,</span><br><span class="line">    <span class="number">14</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">12</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将曲谱转换为钢琴音数组</span></span><br><span class="line"><span class="keyword">let</span> music_list = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; tone.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    music_list.<span class="title function_">push</span>(pitch[tone[i]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// console.log(music_list)</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">AudioContext</span> = <span class="variable language_">window</span>.<span class="property">AudioContext</span> || <span class="variable language_">window</span>.<span class="property">webkitAudioContext</span>,</span><br><span class="line"><span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">AudioContext</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> e = <span class="keyword">new</span> <span class="title class_">AudioContext</span>;</span><br><span class="line">        <span class="keyword">let</span> t = music_list;</span><br><span class="line">        <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> o = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> element_classname) &#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(item)[<span class="number">0</span>].<span class="title function_">addEventListener</span>(<span class="string">&quot;mouseenter&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> r = t[i];</span><br><span class="line">                r || (i = <span class="number">0</span>, r = t[i]), i += o;</span><br><span class="line">                <span class="keyword">let</span> c = e.<span class="title function_">createOscillator</span>();</span><br><span class="line">                <span class="keyword">let</span> l = e.<span class="title function_">createGain</span>();</span><br><span class="line">                c.<span class="title function_">connect</span>(l);</span><br><span class="line">                l.<span class="title function_">connect</span>(e.<span class="property">destination</span>);</span><br><span class="line">                c.<span class="property">type</span> = <span class="string">&quot;sine&quot;</span>;</span><br><span class="line">                c.<span class="property">frequency</span>.<span class="property">value</span> = r;</span><br><span class="line">                l.<span class="property">gain</span>.<span class="title function_">setValueAtTime</span>(<span class="number">0</span>, e.<span class="property">currentTime</span>);</span><br><span class="line">                l.<span class="property">gain</span>.<span class="title function_">linearRampToValueAtTime</span>(<span class="number">1</span>, e.<span class="property">currentTime</span> + <span class="number">.01</span>);</span><br><span class="line">                c.<span class="title function_">start</span>(e.<span class="property">currentTime</span>);</span><br><span class="line">                l.<span class="property">gain</span>.<span class="title function_">exponentialRampToValueAtTime</span>(<span class="number">.001</span>, e.<span class="property">currentTime</span> + <span class="number">1</span>);</span><br><span class="line">                c.<span class="title function_">stop</span>(e.<span class="property">currentTime</span> + <span class="number">1</span>);</span><br><span class="line">                n = !<span class="number">1</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>

<h2 id="完成"><a href="#完成" class="headerlink" title="完成"></a>完成</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="/302.html?target=https://fairysen.com/354.html#toc-head-11">雾时之森</a><br><a href="/302.html?target=http://www.jianpu.cn/pu/44/449109.htm">歌谱简谱网</a></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Javascript/">Javascript</a></div><div class="post_share"></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="wxp://f2f0NKAEBnugPKw0admZMt7DHc3KmIzanXv5sLa2hLIr0RhV33hxzL8A88SNAiFt8lJn" target="_blank"><img class="post-qr-code-img" src="/dist/images/reward/images/wxpay.png" alt="微信支付"/></a><div class="post-qr-code-desc">微信支付</div></li><li class="reward-item"><a href="https://qr.alipay.com/fkx15760bja9yaagobntrcf" target="_blank"><img class="post-qr-code-img" src="/dist/images/reward/images/alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li><li class="reward-item"><a href="https://i.qianbao.qq.com/wallet/sqrcode.htm?m=tenpay&amp;f=wallet&amp;a=1&amp;ac=CAEQ3774rgMYq778ngZCIGNlMDA1YzNjMDhiZTQyMmEyN2RkMjU1ZTE4NGU3YTQ1_xxx_sign&amp;u=903749471&amp;n=%E2%80%8E" target="_blank"><img class="post-qr-code-img" src="/dist/images/reward/images/qqpay.png" alt="QQ支付"/></a><div class="post-qr-code-desc">QQ支付</div></li><li class="reward-item"><a href="/bc1p2anzknthp9597nnhq883tfy5pmsasukglp8e9xn4ehv8l3s75vjs4082h4" target="_blank"><img class="post-qr-code-img" src="/dist/images/reward/images/bitcoin.png" alt="比特币"/></a><div class="post-qr-code-desc">比特币</div></li><li class="reward-item"><a href="/1.3922899487204236e+48" target="_blank"><img class="post-qr-code-img" src="/dist/images/reward/images/ethereum.png" alt="以太币"/></a><div class="post-qr-code-desc">以太币</div></li><li class="reward-item"><a href="/4AaDtjKpgj43ZBC724LjFHZ6Tgx4sxqyr3iraxbLkzEPVNQQ24QtTQr6i18pzWnGKTbXkx5eZyUqMazTvPkjPcZSPmmNHt3" target="_blank"><img class="post-qr-code-img" src="/dist/images/reward/images/monero.png" alt="门罗币"/></a><div class="post-qr-code-desc">门罗币</div></li><li class="reward-item"><a href="https://www.paypal.com/paypalme/lolifjcn" target="_blank"><img class="post-qr-code-img" src="/dist/images/reward/images/paypal.png" alt="贝宝"/></a><div class="post-qr-code-desc">贝宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/09/26/%E9%80%9A%E8%BF%87OpenInterpreter%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%89%A7%E8%A1%8CGPT%E6%8F%90%E4%BE%9B%E7%9A%84%E4%BB%A3%E7%A0%81%E6%96%B9%E6%A1%88/" title="【笔记】通过OpenInterpreter实现自动执行GPT提供的代码方案"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">【笔记】通过OpenInterpreter实现自动执行GPT提供的代码方案</div></div></a></div><div class="next-post pull-right"><a href="/2023/09/23/%E5%BC%95%E5%85%A5Github%E4%B8%8A%E7%9A%84Nodejs%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97/" title="【笔记】引入Github上的Nodejs第三方模块"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">【笔记】引入Github上的Nodejs第三方模块</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/dist/images/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">绯鞠</div><div class="author-info__description">捕捉一只爱折腾的绯鞠</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2918</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">115</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:00-isomer-cabbies@icloud.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #000000;"></i></a><a class="social-icon" href="https://t.me/LittleSweetCookie" target="_blank" title="Telegram"><i class="fab fa-telegram" style="color: #000000;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="toc-number">2.</span> <span class="toc-text">源代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%88%90"><span class="toc-number">3.</span> <span class="toc-text">完成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="toc-number">4.</span> <span class="toc-text">参考文献</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid@10.8.0/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>